# 知识库系统使用指南

## 📚 功能概述

知识库系统帮助 AI 在生成长篇小说时保持世界观、人物关系和情节设定的一致性。通过向量检索技术，AI 可以快速找到相关设定信息。

## 🎯 使用场景

### 1. 世界观设定
存储世界观相关文档：
- 修炼体系
- 地理设定
- 势力分布
- 历史背景

### 2. 人物关系
记录复杂的人物关系网：
- 家族谱系
- 师徒关系
- 恩怨情仇

### 3. 情节设定
保存重要情节点：
- 伏笔设定
- 关键事件
- 时间线

### 4. 专有名词
统一专有名词：
- 功法名称
- 地名
- 物品名称

## 🚀 快速开始

### 创建知识库

1. 进入小说详情页
2. 切换到"知识库"标签
3. 点击"创建知识库"
4. 填写名称和描述
5. 选择类型（通用/世界观/人物关系/情节设定）

### 上传文档

1. 选择一个知识库
2. 点击"上传"按钮
3. 选择文件（支持 TXT, MD, PDF, DOCX）
4. 可选：自定义标题
5. 点击上传

### 语义搜索

1. 在文档列表中输入搜索关键词
2. 系统会使用 AI 语义理解查找相关内容
3. 返回最相关的文档片段

## 💡 最佳实践

### 文档组织

**推荐结构：**
```
小说名/
├── 世界观知识库/
│   ├── 修炼体系.md
│   ├── 地理设定.md
│   └── 势力分布.md
├── 人物关系库/
│   ├── 主角关系网.md
│   └── 配角关系.md
└── 情节设定库/
    ├── 第一卷伏笔.md
    └── 时间线.md
```

### 文档编写

**格式建议：**
```markdown
# 修炼体系

## 境界划分
1. 炼气期（1-9层）
2. 筑基期（初期/中期/后期）
3. 金丹期

## 突破条件
- 炼气 → 筑基：需要筑基丹
- 筑基 → 金丹：需要凝结金丹

## 战力对比
- 筑基初期 ≈ 10个炼气9层
- 金丹初期 ≈ 10个筑基后期
```

### 内容更新

- 定期更新人物状态
- 记录重要情节发展
- 补充新出现的设定
- 删除过时信息

## 🔧 技术细节

### 向量检索原理

1. **文档处理**
   - 上传文档后自动分块
   - 每块生成 1536 维向量（OpenAI Embeddings）
   - 存储到 PostgreSQL + pgvector

2. **语义搜索**
   - 用户输入查询
   - 生成查询向量
   - 计算余弦相似度
   - 返回最相关文档

3. **AI 生成集成**
   - 生成前自动检索相关知识
   - 注入到 AI 提示词中
   - 确保生成内容符合设定

### 支持的文件格式

| 格式 | 扩展名 | 最大大小 | 说明 |
|------|--------|----------|------|
| 纯文本 | .txt | 10MB | 最佳兼容性 |
| Markdown | .md | 10MB | 支持格式化 |
| PDF | .pdf | 10MB | 需要解析 |
| Word | .docx | 10MB | 需要解析 |

## 📊 使用示例

### 示例 1：修炼体系

**文档内容：**
```
修炼境界：炼气 → 筑基 → 金丹 → 元婴

炼气期：
- 共9层
- 主要修炼真气
- 寿命约120年

筑基期：
- 分初中后三期
- 筑基成功率约10%
- 寿命约200年
```

**AI 生成时自动引用：**
> "林凡如今已是炼气九层巅峰，距离筑基只差临门一脚。但他深知，筑基成功率仅有一成..."

### 示例 2：人物关系

**文档内容：**
```
林凡 - 主角
├── 师父：云霄真人（已故）
├── 师姐：柳如烟（暗恋）
├── 好友：王大力（生死之交）
└── 仇人：血煞宗少主（杀父仇人）
```

**AI 生成时保持一致：**
> "想起师父云霄真人的教诲，林凡心中一阵悲痛。若非血煞宗少主害死父亲..."

## ⚠️ 注意事项

### 隐私安全
- 知识库内容仅小说作者可见
- 上传的文件加密存储
- 定期备份重要文档

### 性能优化
- 单个文档建议不超过 5MB
- 每个知识库建议不超过 100 个文档
- 定期清理无用文档

### 成本控制
- 向量生成会消耗 API 额度
- 建议批量上传文档
- 避免重复上传相同内容

## 🔮 未来功能

- [ ] 自动提取关键信息
- [ ] 知识图谱可视化
- [ ] 智能推荐相关文档
- [ ] 多人协作编辑
- [ ] 版本历史管理

---

**开始使用知识库，让 AI 创作更加连贯！** 📖
